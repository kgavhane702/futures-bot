<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bot Admin</title>
    <style>
      body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; background: #0b1020; color: #e6e8f0; }
      header { padding: 16px; background: #0e1630; position: sticky; top: 0; z-index: 10; border-bottom: 1px solid #1b2545; display:flex; justify-content:space-between; align-items:center }
      a { color: #8fb3ff; text-decoration:none }
      .container { padding: 16px; max-width: 900px; margin: 0 auto; }
      .grid { display: grid; grid-template-columns: 1fr; gap: 16px; }
      .card { background: #111936; border: 1px solid #1b2545; border-radius: 12px; padding: 16px; }
      label { display:block; font-size:12px; color:#a8b3cf; margin-top:10px }
      input, select { width:100%; padding:8px; margin-top:4px; border-radius:8px; border:1px solid #1b2545; background:#0e1330; color:#e6e8f0 }
      button { background:#2b6ef3; color:#fff; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; margin-top:12px }
      .row { display:grid; grid-template-columns: 1fr 1fr; gap:12px }
      .msg { font-size:12px; color:#9bd } 
      pre { white-space:pre-wrap; word-break:break-word; background:#0d142e; padding:12px; border-radius:8px; border:1px solid #1b2545 }
    </style>
  </head>
  <body>
    <header>
      <div><a href="/">Dashboard</a> Â· <strong>Admin</strong></div>
      <div>
        <button onclick="doPull()">Git Pull</button>
        <button onclick="doRestart()">Request Restart</button>
      </div>
    </header>
    <div class="container">
      <div class="card">
        <h3>Environment</h3>
        <div id="msg" class="msg"></div>
        <form id="envForm" onsubmit="return saveEnv(event)">
          <div class="row">
            <div>
              <label>EXCHANGE</label>
              <input name="EXCHANGE" value="{{ env['EXCHANGE'] }}" />
            </div>
            <div>
              <label>USE_TESTNET</label>
              <select name="USE_TESTNET"><option value="false" {{ 'selected' if env['USE_TESTNET']=='false' else '' }}>false</option><option value="true" {{ 'selected' if env['USE_TESTNET']=='true' else '' }}>true</option></select>
            </div>
          </div>
          <div class="row">
            <div>
              <label>API_KEY</label>
              <input name="API_KEY" placeholder="keep blank to retain" />
            </div>
            <div>
              <label>API_SECRET</label>
              <input name="API_SECRET" placeholder="keep blank to retain" />
            </div>
          </div>
          <div class="row">
            <div>
              <label>TIMEFRAME</label>
              <input name="TIMEFRAME" value="{{ env['TIMEFRAME'] }}" />
            </div>
            <div>
              <label>HTF_TIMEFRAME</label>
              <input name="HTF_TIMEFRAME" value="{{ env['HTF_TIMEFRAME'] }}" />
            </div>
          </div>
          <div>
            <label>UNIVERSE_SYMBOLS (comma separated)</label>
            <input name="UNIVERSE_SYMBOLS" value="{{ env['UNIVERSE_SYMBOLS'] }}" />
          </div>
          <div class="row">
            <div>
              <label>UNIVERSE_SIZE</label>
              <input name="UNIVERSE_SIZE" value="{{ env['UNIVERSE_SIZE'] or '12' }}" />
            </div>
          </div>
          <div class="row">
            <div>
              <label>MAX_POSITIONS</label>
              <input name="MAX_POSITIONS" value="{{ env['MAX_POSITIONS'] }}" />
            </div>
            <div>
              <label>LEVERAGE</label>
              <input name="LEVERAGE" value="{{ env['LEVERAGE'] }}" />
            </div>
          </div>
          <div class="row">
            <div>
              <label>MARGIN_MODE</label>
              <input name="MARGIN_MODE" value="{{ env['MARGIN_MODE'] }}" />
            </div>
            <div>
              <label>ENTRY_SLIPPAGE_MAX_PCT</label>
              <input name="ENTRY_SLIPPAGE_MAX_PCT" value="{{ env['ENTRY_SLIPPAGE_MAX_PCT'] }}" />
            </div>
          </div>
          <div class="row">
            <div>
              <label>ATR_MULT_SL</label>
              <input name="ATR_MULT_SL" value="{{ env['ATR_MULT_SL'] }}" />
            </div>
            <div>
              <label>TP_R_MULT</label>
              <input name="TP_R_MULT" value="{{ env['TP_R_MULT'] }}" />
            </div>
          </div>
          <div class="row">
            <div>
              <label>POLL_SECONDS</label>
              <input name="POLL_SECONDS" value="{{ env['POLL_SECONDS'] }}" />
            </div>
            <div>
              <label>ENABLE_WEB</label>
              <select name="ENABLE_WEB"><option value="true" {{ 'selected' if env['ENABLE_WEB']=='true' else '' }}>true</option><option value="false" {{ 'selected' if env['ENABLE_WEB']=='false' else '' }}>false</option></select>
            </div>
          </div>
          <button type="submit">Save .env</button>
        </form>
      </div>
      <div class="card">
        <h3>Actions</h3>
        <button onclick="doPull()">Git Pull</button>
        <button onclick="doRestart()">Request Restart</button>
        <div id="actionOut"></div>
      </div>
    </div>
    <script>
      async function saveEnv(e){
        e.preventDefault();
        const form = document.getElementById('envForm');
        const data = Object.fromEntries(new FormData(form).entries());
        // Keep API secrets if left blank
        if(!data.API_KEY) delete data.API_KEY; if(!data.API_SECRET) delete data.API_SECRET;
        const r = await fetch('/api/env', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(data) });
        const j = await r.json();
        document.getElementById('msg').textContent = j.ok ? 'Saved .env' : ('Failed: '+(j.error||''));
        return false;
      }
      async function doPull(){
        const r = await fetch('/api/git_pull', { method:'POST' }); const j = await r.json();
        const el = document.getElementById('actionOut'); el.innerHTML = '<pre>'+JSON.stringify(j, null, 2)+'</pre>';
      }
      async function doRestart(){
        const r = await fetch('/api/restart', { method:'POST' }); const j = await r.json();
        const el = document.getElementById('actionOut'); el.textContent = j.ok ? 'Restart requested' : ('Failed: '+(j.error||''));
      }
    </script>
  </body>
 </html>


